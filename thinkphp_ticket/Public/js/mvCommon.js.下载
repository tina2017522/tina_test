(function(a,b,c){b.isIos=/(iPhone|iPad|iPod)/ig.test(navigator.userAgent);b.extend(c,{initEmlEvent:function(){this.wantToSeeEventInit.init()},isValidEmail:function(d){return/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(d.trim())},adialog:null,wantToSeeMobile:"",wantToSee:function(g){var e=c;if(!e.easyNav.isLogin(true)){e.login();return}e.seeMvBtn=!!g?g:b(this);if(!e.seeMvBtn.hasClass("want_see_active")){var f=b('<div class="wantDialog"><h2>想看就留个方式呗，上映了俺提醒你<a href="javascript:;" class="closeBtn"></a></h2><div class="inputBox"><input type="checkbox" id="cbxMobile" rel="#wantToSeeMobile"><label for="wantToSeeMobile">手机：</label><input type="text" class="inputTxt" id="wantToSeeMobile" value="'+e.wantToSeeMobile+'" maxlength="11"/><p class="hide2">手机号码格式不正确!</p><input type="checkbox" id="cbxEmail" rel="#wantToSeeEmail"><label for="wantToSeeEmail">邮箱：</label><input type="text" class="inputTxt" id="wantToSeeEmail" value="'+b("em","#user163Name").text()+'"/><p class="hide2">邮箱格式不正确!</p></div><input type="button" value="确定" class="btnSub" id="btnSub" /></div>');var d=b.isIE6?"defaultChecked":"checked";if(!!e.wantToSeeMobile){f.find("#cbxMobile").get(0)[d]="checked"}if(!!b("em","#user163Name").text()){f.find("#cbxEmail").get(0)[d]="checked"}e.adialog=e.showDialogFunc({content:f,width:632,type:"shell",init:function(){b(".iDialogClose").remove();b(".closeBtn").click(function(){b.dialog()})}})}else{e.post("/movie/cancel_notify.html",{movieId:e.seeMvBtn.attr("pid"),city:e.curCity.id},function(j,i){if(!j){i=e.parseJSON(i);if(i.retcode==200){if(+e.seeMvBtn.find("i").length){var h=e.seeMvBtn.find("i")}else{var h=e.seeMvBtn.parents("li").find(".wantSeeSum")}e.seeMvBtn.removeClass("want_see_active");h.text(+h.text()-1);e.seeMvBtn=null}}})}},wantToSeeEventInit:{init:function(){this.get_phone();b(document.body).delegate("#btnSub","click",this.subWantToSeeInfo).delegate("#wantToSeeEmail","focus",this.emailOrMobileFocus).delegate("#wantToSeeMobile","focus",this.emailOrMobileFocus).delegate("#wantToSeeMobile","keyup",this.mobileKeyup).delegate("#cbxEmail,#cbxMobile","click",this.cbxClick)},get_phone:function(){var d=c;d.post("/movie/get_phone.html",{},function(g,f){if(!g){f=d.parseJSON(f);if(f.retcode==200){if(b("#wantToSeeMobile")[0]){b("#wantToSeeMobile").text(f.phone);var e=b.isIE6?"defaultChecked":"checked";b("#cbxMobile").get(0)[e]="checked"}d.wantToSeeMobile=f.phone||""}}})},subWantToSeeInfo:function(){var e=c;if(!e.easyNav.isLogin(true)){e.login();return}var g=e.wantToSeeEventInit.checkInput();if(!g.email&&!g.mobile){return false}var f={email:g.email,phone:g.mobile,movieId:e.seeMvBtn.attr("pid"),city:e.curCity.id};e.post("/movie/mail.html",f,function(i,h){b.dialog(e.adialog);if(!i){h=e.parseJSON(h);if(h.retcode==200){if(+e.seeMvBtn.find("i").length){var d=e.seeMvBtn.find("i")}else{var d=e.seeMvBtn.parents("li").find(".wantSeeSum")}e.seeMvBtn.addClass("want_see_active");d.text(+d.text()+1);e.seeMvBtn=null}else{if(h.retcode==401){e.login()}}}})},checkInput:function(){var d=c,e,f,h,g={};if(b("#cbxMobile").get(0).checked){e=b("#wantToSeeMobile");f=e.next();h=e.val().trim();if(h){if(!(/^1\d{10}$/g.test(h))){f.text("手机号码格式不正确！").removeClass("hide2");e.select();return false}else{f.addClass("hide2")}}else{f.text("请输入手机号！").removeClass("hide2");e.focus();return false}g.mobile=h}if(b("#cbxEmail").get(0).checked){e=b("#wantToSeeEmail");f=e.next();h=e.val().trim();if(h){if(!d.isValidEmail(h)){f.text("邮箱格式不正确！").removeClass("hide2");e.select();return false}else{f.addClass("hide2")}}else{f.text("请输入邮箱！").removeClass("hide2");e.focus();return false}g.email=h}return g},emailOrMobileFocus:function(){if(this.value.length>0){this.select()}b(this).prev().prev().get(0).checked=true},mobileKeyup:function(){var d=this.value.replace(/\D/g,"");this.value=d},cbxClick:function(){var e=b(this),d=b(e.attr("rel"));if(!this.checked){if(d.val().length>0){d.disabled("disabled")}d.next().addClass("hide2")}else{d.enabled("disabled")}}},redeemCodeDialog:function(d){var f=c;var m='<span check="0" class="input" gbid=""><div style="float:left;position:relative;"><span class="code_err_text">兑票码不正确</span><span class="code_right_text"></span><input type="text" value="请输入一个兑票码" maxlength="12" class="code_input textGray"></div><a class="checkBtn ml14" href="javascript:;">验证</a><a href="javascript:;" class="fast_code_del ml15 none title="先不用这个码了">删除</a></span>';var o=b('<div class="rDialog"><div id="warmE"> <h2>来吧亲，让我看看你的兑票码！<div class="notes"><em></em>兑票码不是代金券，是可以兑换多家影院电影票的电子码，由12位字母和数字组成，一码换一票</div><b class="help"></b></h2><h3>想要兑换几张票，就分别输入几个码，一次最多可以兑换<em>5</em>张</h3><div class="inputBox"></div></div><div class="mt10 clearfix"> <a class="add" id="addNewCode" href="javascript:;">我还有兑票码要输入</a></div><div class="rDialogFoot"><a id="subBtn" href="javascript:;" class="rDialogBtn rDialogBtn_disabled">去兑票</a><br/><span class="warnInfo hide2">请使用同一类型的码兑票</span></div></div>');var g=o.find(".inputBox");if(!!d&&d.length>=12){var e=d.split("|"),l=e.length,n;for(var k=0,h=l;k<h;k++){if(!e[k]){continue}n=b(m);n.find(".code_input").val(e[k]);g.append(n);if(g.find(".code_input").length>=5){o.find("#addNewCode").addClass("none");break}}g.find(".code_input").removeClass("textGray");g.find(".fast_code_del").removeClass("none");o.find("#subBtn").addClass("rDialogBtn_disabled")}else{g.append(m)}o.find(".help").hover(function(){b(this).prev().css({display:"block"})},function(){b(this).prev().css({display:"none"})});g.delegate(".code_input","keyup",function(){var i=/[^0-9a-zA-Z]/g,j=this.value.trim();this.value=j.replace(i,"")});g.delegate(".code_input","mouseover",function(){b(this).addClass("input_hover")});g.delegate(".code_input","mouseout",function(){b(this).removeClass("input_hover")});g.delegate(".code_input","focus",function(){b(this).removeClass("textGray").addClass("input_focus");b(this).parent().removeClass("code_error");var i=b(this).val().trim();if(i=="请输入一个兑票码"){b(this).val("")}});g.delegate(".code_input","blur",function(){b(this).addClass("textGray").removeClass("input_focus");var i=b(this).val().trim();if(i==""){b(this).val("请输入一个兑票码");b(this).parent().removeClass("active code_error")}});g.delegate(".checkBtn","click",function(){var i=b(this).prev().find("input"),r=i.val().trim();if(r.length==12){var q=false;g.find('.input[check="1"] .code_input').each(function(t,s){if(r==b(s).val().trim()){q=true;return false}});if(q){alert("您输入了重复的通兑码！");i.get(0).select();return}var p=b(this).parent().find(".code_check"),j="";if(p.length>0){j=p.find(".code_check_input").val().trim();if(!j){p.find(".codeCheck_err_text").removeClass("none").text("请输入验证码");return}p.remove();b(this).parent().removeClass("checkCode")}f.checkCode(b(this).parent(),r,j)}else{b(this).parent().addClass("active code_error")}});g.delegate(".fast_code_del","click",function(){var j=b(this).parent().parent();b(this).parent().remove();b("#addNewCode").removeClass("none");var p=g.find(".input").length;if(p<=1){g.find(".fast_code_del").addClass("none")}var i=f.checkGbid(j);if(g.find('.input[check="0"]').length<=0&&i){b("#subBtn").removeClass("rDialogBtn_disabled")}});o.find("#addNewCode").click(function(){var i=g.find(".input").length;if(i>=5){return false}g.append(m);g.find(".fast_code_del").removeClass("none");b("#subBtn").addClass("rDialogBtn_disabled");i=g.find(".input").length;if(i>=5){b(this).addClass("none")}});o.find("#subBtn").click(function(){if(b(this).hasClass("rDialogBtn_disabled")){return}var i="";if(g.find('.input[check="0"]').length>0){alert("有未验证通兑码!");g.find('.input[check="0"]').addClass("active");return}g.find(".code_input").each(function(p,j){i+="|"+j.value});c.subMitCode(i.substr(1),b(this))});b.dialog();b.dialog({title:"",content:o,css:"fast_enter",width:640,button:[]})},getCodeSubminted:function(){var d=c;d.post("/order/rebate/code_get_submited.html",{},function(f,e){if(!f){if(e.retcode==200){d.redeemCodeDialog(e.codeList)}else{if(e.retcode==400){d.redeemCodeDialog()}else{if(e.retcode==410){b.dialog();d.login()}}}}})},checkGbid:function(e){var d=true,f=e.parent().parent().find(".rDialogFoot > .warnInfo"),g=e.find('.input[check="1"]');f.html("请使用同一类型的码兑票");if(g.length>=2){var h=g.first().attr("gbid");g.each(function(j,k){var i=b(k).attr("gbid");if(i!=h){d=false;return false}});if(d){f.addClass("hide2")}else{f.removeClass("hide2")}}else{f.addClass("hide2")}return d},checkCode:function(g,f,e){var d=c;d.post("/order/rebate/my_code_check.html",{rebate_code:f,check_code:e},function(k,i){if(!k){i=d.parseJSON(i);if(i.retcode==200){g.find(".code_right_text").text(i.codeName);g.removeClass("active code_error").addClass("code_right").attr("check","1");g.attr("gbid",i.groupBuyId);g.find(".code_input").attr("disabled",true);g.find(".checkBtn").remove();g.find(".code_check").remove();var h=d.checkGbid(g.parent());if(g.parent().find('.input[check="0"]').length<=0&&h){b("#subBtn").removeClass("rDialogBtn_disabled")}}else{if(i.retcode==201||i.retcode==202||i.retcode==203||i.retcode==206||i.retcode==207){g.addClass("active code_error");if(i.retcode==201){g.find(".code_err_text").text("兑票码不正确")}else{if(i.retcode==202){g.find(".code_err_text").text("兑票码未生效")}else{if(i.retcode==203){g.find(".code_err_text").text("兑票码已使用")}else{if(i.retcode==206){g.find(".code_err_text").text("兑票码已过期")}else{if(i.retcode==207){g.find(".code_err_text").text("兑票码被占用")}}}}}if(i.needCheckCode){var j=g.find(".code_check");j.find("input").val("");j.find("img").attr("src",i.checkCodeUrl);j.find(".codeCheck_err_text").addClass("none")}}else{if(i.retcode==204||i.retcode==205){var j=g.find(".code_check");j.find("input").val("");j.find("img").attr("src",i.checkCodeUrl);j.find(".codeCheck_err_text").removeClass("none").text("验证码不正确")}else{if(i.retcode==300){g.addClass("active checkCode").removeClass("code_error");g.append('<div class="code_check"><input type="text" class="code_check_input" maxlength="4"><img src="'+i.checkCodeUrl+'" alt=""/><span class="codeCheck_err_text none">验证码不正确</span></div>');g.find(".code_check > input").focus()}else{if(i.retcode==400){alert("网络超时，请重试")}else{if(i.retcode==410){b.dialog();d.login()}}}}}}}})},subMitCode:function(d,f){var e=c;e.post("/order/rebate/code_check_submit.html",{rebate_code_list:d},function(i,h){if(!i){h=e.parseJSON(h);var g=f.parent().find("span");switch(+h.retcode){case 200:b.dialog();b.dialog({type:"shell",title:"",content:'<div class="iDialogContent"><a id="fastBuyClose" href="javascript:;" class="fastBuyClose"></a><iframe scrolling="no" frameborder="0" style="width:100%;height:500px;overflow:hidden;" src="../fast/dispatch.html?groupBuyId='+h.groupBuyId+'"></iframe></div>',width:960,button:[]});b(document).delegate("#fastBuyClose","click",function(){b.dialog()});break;case 202:case 203:g.removeClass("hide2").html("以下通兑码已被使用或者被占用 "+h.inValidCodeList);break;case 206:g.removeClass("hide2").html("一次最多可以兑换5张");break;case 208:g.removeClass("hide2").html("抱歉，工程师正在紧急维修兑票码系统，请稍后再试。");break;case 300:g.removeClass("hide2").html("您的兑换码有问题，请重新核对再提交！");break;case 400:alert("网络超时，请重试");break;case 410:b.dialog();e.login();break}}})},view:function(d,g){var f=b("<div style='width:720px;height:416px; overflow:hidden;background:black;'>").appendTo(document.body);var e="<div style='width:500px;height:200px;line-height:200px;overflow:hidden;background:#fff;text-align:center;'>您的浏览器木有装flash播放器，无法播放预告片，请<a href='http://get.adobe.com/cn/flashplayer/' target='_blank'>点此安装</a>！</div>";this.insertFlash(f,{path:d,id:"video"+(+new Date()),width:720,height:416,fullScreen:true},function(i,h){if(!b.isIos&&(!i||h<9)){b.dialog({title:"",content:e,width:0,height:0,button:[],animate:0,position:g&&g.position?g.position:"c",css:""});f.remove();return false}else{b.dialog({title:"",content:f,type:"insert",width:0,height:0,button:[],animate:0,position:g&&g.position?g.position:"c",css:"",beforeClose:function(){f.empty()}},function(){f.remove()})}})},viewS:function(d,g){var f=b("<div style='width:620px;height:358px; overflow:hidden;background:black;'>").appendTo(document.body);var e="<div style='width:500px;height:200px;line-height:200px;overflow:hidden;background:#fff;text-align:center;'>您的浏览器木有装flash播放器，无法播放预告片，请<a href='http://get.adobe.com/cn/flashplayer/' target='_blank'>点此安装</a>！</div>";this.insertFlash(f,{path:d,id:"video"+(+new Date()),width:620,height:358,fullScreen:true},function(i,h){if(!b.isIos&&(!i||h<9)){b.dialog({title:"",content:e,width:0,height:0,button:[],animate:0,position:g&&g.position?g.position:"c",css:""});f.remove();return false}else{b.dialog({title:"",content:f,type:"insert",width:0,height:0,button:[],animate:0,position:g&&g.position?g.position:"c",css:"",beforeClose:function(){f.empty()}},function(){f.remove()})}})}})})(window,jQuery,Core);