(function(a){if(window.define&&define.amd){define(["jquery"],function(b){a(window,b)})}else{if(window.jQuery){a(window,window.jQuery)}}})(function(j,g,c){var l=j.document,h=(function(){var p={},o=navigator.userAgent.toLowerCase(),n=/(webkit)[ \/]([\w.]+)/.exec(o)||/(opera)(?:.*version)?[ \/]([\w.]+)/.exec(o)||/(msie) ([\w.]+)/.exec(o)||/(trident)\/.+rv:([\w.]+)/.exec(o)||o.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+))?/.exec(o)||[];if(n[1]){p[n[1]]=1;p.version=n[2]||"0"}if(p.trident||p.msie){p.msie=1;p.version=l.documentMode||p.version}if(/qqbrowser\/(\d+)/.test(o)){p.fucker=1;p.qq=1;p.version=RegExp.$1}p.version=""+p.version;p.ver=+p.version.replace(/\..*$/,"");return p})(),a=(function(){var o=l.createElement("div").style,n="";if(o.transition!==c){return"transitionend"}g.each({WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd"},function(q,p){if(o[q]!==c){n=p}});return n})(),e=h.msie&&h.ver<7,i=!a||h.fucker||(h.msie&&h.ver<10);if(!j.Class||!g){return}var b={grayLayoutNum:0,layoutNum:0,prepareDoms:function(u,p,o){var s=this.getMaxWH(),r=g("<div class='iDialogLayout'></div>").appendTo(this.body[0]).css("zIndex",u),q=r.css("position").toLowerCase()==="fixed",t=e?g("<iframe frameborder='0' class='iFrameGround fullFrameGround'/>").insertBefore(r).css("zIndex",u):0,n=p!==2&&(p!==1||this.grayLayoutNum>0);p={1:1,2:2}[p]||-1;if(n){r.addClass("iOpacityZero")}else{this.grayLayoutNum++}this.layoutNum++;if(o){r.addClass(o)}q||r.height(s.height);if(t){t.width(s.width).height(s.height);r.width(s.width);this.win.unbind("resize",this.resize).resize(this.resize)}return{layout:r,frame:t,opacityZero:n}},getMaxWH:function(){var n=this.body=this.body||g(l.body),o=this.win=this.win||g(o);return{width:Math.max(n.outerWidth(),l.documentElement.clientWidth),height:Math.max(n.outerHeight(),o.height(),l.documentElement.clientHeight)}},resize:function(){var n=b.getMaxWH();g(".fullFrameGround,.iDialogLayout").width(n.width).height(n.height)},animate:function(p,n,o,q){if(o==1&&i){o=0}if(o==1){p[n==1?"hide":"show"]()[n==1?"fadeIn":"fadeOut"](300,q||g.noop)}else{(q||g.noop)()}}};var m=Class.Base.Event.extend("Widgets.Layout",{init:function(o){this.callSuper("onCreate onClick onDestroy");var n=this,p=b.prepareDoms(o.zindex||o.zIndex,o.type,o.css);this.options=o;this.opacityZero=p.opacityZero;this.cache=p;if(o.animate&&!p.opacityZero){b.animate(p.layout,1,o.animate)}p.layout.mousedown(function(q){n.trigger("onClick",p.layout,p.opacityZero)});j.setTimeout(function(){n.trigger("onCreate",p)},0)},destroy:function(){var n=this,p=n.options,q=n.cache.layout,r=n.cache.frame,o=function(){n.options=n.cache=c;q[0]&&q.remove();r&&r[0]&&r.remove();if(b.layoutNum===0){b.win.unbind("resize",b.resize)}n.trigger("onDestroy")};this.destroy=g.noop;if(!this.opacityZero){b.grayLayoutNum--}b.layoutNum--;if(p.animate&&!this.opacityZero&&q[0]){b.animate(q,2,p.animate,o)}else{o()}}});var f={title:null,content:"",type:"html",width:0,height:0,button:["*确定"],css:"",position:"c",method:"prepend",dragable:1,layout:1,animate:15,timeout:0};var d={guid:0,cache:{},getCacheInfo:function(){var n={dialogNum:0,layoutNum:0,opacityZeroLayout:0};g.each(this.cache,function(p,o){n.dialogNum++;if(o.layout){n.layoutNum++;if(o.layout.opacityZero){n.opacityZeroLayout++}}});return n},zindex:{model:10000,modeless:1000},checkOptions:function(n,r){var q=g.extend({},f,n||{},g.isFunction(r)?{callback:r}:{});if(g.isFunction(q.check)){var p=q.check;q.check=function(t,s){return p.call(this.wrap[0],+t,s[0])}}if(g.isFunction(q.init)){var o=q.init;q.init=function(){return o.call(this.wrap[0])}}q.layout=(function(s){var t={"false":0,"true":1,"-1":-1,0:0,1:1,2:2}[s];return t===c?-1:t})(q.layout);q.animate=(function(t){var s=t,u=t;if(t>2){s=parseInt(t/10);u=t-10*s}return i?s:u})(q.animate);return q},bindParaEvent:function(n){if(!n){return}var o=n.options;g.each({init:"onCreate",check:"onBtnClick",beforeClose:"onBeforeClose",callback:"onDestroy"},function(p,q){g.isFunction(o[p])&&n.bind(q,o[p])})},prepareDoms:function(s,r){var q=/^\*/,p="",n=['<div class="iDialog" style="visibility:hidden;z-index:',r.zindex,'" id="',s,'">',e&&!r.layout?'<iframe frameborder="0" class="iFrameGround"/>':"",'<table class="iDialogWrapTable"><tr><td class="itd-top-left"></td><td class="itd-top-center"></td><td class="itd-top-right"></td></tr><tr><td class="itd-mid-left"></td><td class="itd-mid-center">','<div class="iDialogContent">','<div class="iDialogHead hide"><h1></h1></div><a class="iDialogClose hide" hidefocus="true" href="#"></a>','<div class="iDialogBody"><div class="iDialogMain"></div></div>',(!r.button||!r.button.length)?p:(function(){var v=['<div class="iDialogFoot">'],u=r.button,x=u.length,t=0,w=0;for(;t<x;t++){v[t+1]='<a href="javascript:;" rel="'+(x>1?x-t-1:1)+'" class="iDialogBtn'+(q.test(u[t])&&!w?(w++," focusBtn"):p)+'"><span>'+u[t].replace(q,"")+"</span></a>"}v[x+1]="</div>";return v.join(p)})(),"</div>",'</td><td class="itd-mid-right"></td></tr><tr><td class="itd-bot-left"></td><td class="itd-bot-center"></td><td class="itd-bot-right"></td></tr></table>',"</div>"].join(p);g(l.body)[r.method](n);var o=g("#"+s).addClass(r.css||"");return{wrap:o,content:g(".iDialogContent",o),main:g(".iDialogMain",o),ground:g(".iFrameGround",o),closeBtn:g(".iDialogClose",o),title:g(".iDialogHead",o)}},markDom:function(o){var n=g(o).eq(0),p="posMark"+(+new Date());if(!n[0]){return null}if(!n[0].orgPosMarkId){n.after("<div style='display:none' id='"+p+"'/>");n[0].orgPosMarkId=p;n[0]._display=n.css("display")}return n.show()},revertDom:function(n){var o=n.cache.orgDom;if(o){o[0]&&g("#"+o[0].orgPosMarkId).before(o.css("display",o[0]._display));delete n.cache.orgDom}},updateDom:function(o,p,n){o.find("iframe").remove();o[p](n)},posReg:{l:/l/i,t:/t/i,r:/r/i,b:/b/i,c:/c/i},calPosition:function(y,q,A,w){var v={},t=w==="fixed",x=g(j),z=[x.scrollLeft(),x.scrollTop()],p=[0,0,x.width(),x.height()],s={left:(function(){return t?{left:0}:{left:p[0]+z[0]}})(),center:(function(){return t?{left:"50%",marginLeft:"-"+q/2+"px"}:{left:Math.floor((p[2]+p[0]-q)/2)+z[0]}})(),right:(function(){return t?{right:0}:{left:p[2]-q+z[0]}})()},o={top:(function(){return t?{top:0}:{top:p[1]+z[1]}})(),center:(function(){var B=Math.floor((p[3]+p[1]-A)/2)+z[1],r=B<0?Math.abs(B):0;return t?{top:"50%",marginTop:"-"+(A/2-r)+"px"}:{top:r?0:B}})(),bottom:(function(){return t?{bottom:0}:{top:Math.max(0,p[3]-A+z[1])}})()};switch(y.constructor){case String:var n=this.posReg;y=y.length==1?y+"c":y;y=n.t.test(y)?n.l.test(y)?1:n.r.test(y)?3:2:n.b.test(y)?n.l.test(y)?7:n.r.test(y)?5:6:n.c.test(y)?n.l.test(y)?8:n.r.test(y)?4:0:0;case Number:if(y<0||y>8){break}var u=[[s.center,o.center],[s.left,o.top],[s.center,o.top],[s.right,o.top],[s.right,o.center],[s.right,o.bottom],[s.center,o.bottom],[s.left,o.bottom],[s.left,o.center]];g.extend(v,u[y][0],u[y][1]);break;case Array:v.left=y[0]===0?0:(y[0]||"");v.top=y[1]===0?0:(y[1]||"");break;default:v=g.extend({},y||{});break}g.each(["left","right","top","bottom"],function(C,B){var D=v[B],r=["auto","c","center"];if(B in v&&(D?g.inArray(D,r)>=0:D!==0)){delete v[B]}});if(!("left" in v)&&!("right" in v)){g.extend(v,s.center)}if(!("top" in v)&&!("bottom" in v)){g.extend(v,o.center)}return v},bindDrag:function(q,p){var o=p==2?q:g(".iDialogHead",q),t,n;if(!o[0]||(!p&&p!==0)||o.css("cursor")=="move"){return}if(!g.fn.bindDrag){return"缺少拖动组件 $.fn.bindDrag，无法绑定拖动。"}var s=q.css("position").toLowerCase()=="fixed",r=s?function(u){return{left:u[0].offsetLeft,top:u[0].offsetTop}}:function(u){return u.offset()};o.css("cursor","move").bindDrag({beforeDrag:function(y){var x=g(y.target),v=x[0].tagName.toLowerCase(),w=x.closest("label",o),u=true;g.each("a button select input textarea object applet".split(" "),function(A,z){if(v===z||x.closest(z,o)[0]){u=false}});if(w[0]&&w.attr("for")){u=false}return u},dragStart:function(u){t=r(q);n=[u.pageX,u.pageY];q.css({marginLeft:"",marginTop:"",left:t.left,top:t.top,right:"",bottom:""});g(".iDialogDragLayoutHelper",q).show()},onDrag:function(u){q.css({left:t.left+u.pageX-n[0],top:t.top+u.pageY-n[1]})},dragEnd:function(y){var A=r(q),x=g(j),w=[x.width(),x.height()],z=[q.width(),q.height()],v=s?[0,0]:[x.scrollTop(),x.scrollLeft()],u={};u.top=Math.max(v[0],Math.min(A.top,w[1]-40+v[0]));u.left=Math.min(w[0]-40+v[1],Math.max(A.left,60-z[0]+v[1]));if(u.top!=A.top||u.left!=A.left){q.animate(u,200)}g(".iDialogDragLayoutHelper",q).hide()}})},unbindDrag:function(n){if(!n){return}var p=n.wrap,o=n.options.dragable;if(p[0]&&o){(o==2?p:p.find(".iDialogHead")).unbind("mousedown").css("cursor","");d.bindMoveTop(n)}},fixIframeGround:function(o){var n=o?o.cache.ground:0;n&&n.css("zIndex",-1).width(o.width()).height(o.height())},bindMoveTop:function(n){if(!n||n.layout){return}n.wrap.mousedown(function(){d.moveTop(n)})},moveTop:function(p){if(!p||p.layout||p.closing||p.closed){return}var n=p.options.zindex,o=0;g.each(d.cache,function(s,r){if(r&&!r.closed&&!r.closing&&!r.layout){var q=r.options.zindex;if(q<d.zindex.modeless&&q>n){r.wrap.css("zIndex",r.options.zindex=q-1);o=q>o?q:o}}});o&&p.wrap.css("zIndex",p.options.zindex=o)},findTopDialog:function(){var n=0,o=null;g.each(this.cache,function(r,q){if(q&&!q.closing&&!q.closed){var p=q.options.zindex;o=p>n?(n=p,q):o}});return o},focusBtn:function(n){n=n||d.findTopDialog();if(!n||(l.hasFocus&&!l.hasFocus())){return}g(".iDialogBtn[rel=1]",n.wrap).focus();g(".focusBtn:visible",n.wrap).focus()},closeTopDialog:function(o){if(o&&o.keyCode==27){var n=d.findTopDialog();if(n&&g(".iDialogClose:visible",n.wrap).length){n.close()}}},checkShortCut:function(){g(l).unbind("keydown",this.closeTopDialog);for(var n in this.cache){g(l).keydown(this.closeTopDialog);return}},bindBtnClick:function(n){var o=n.wrap;if(o[0]&&!o[0].initButtonClick){o.delegate(".iDialogBtn","click",function(q){var r=parseInt(g(this).attr("rel")||"-1",10),p=n.trigger("onBtnClick",r,g(this));p=p===c?r:p;if(p!==false){n.close(p)}q.preventDefault()}).delegate(".iDialogClose","click",function(p){n.close(null);p.preventDefault()});o[0].initButtonClick=true}},animate:function(p,r,s,v){var q,t,o=["iDialogShowAniCore","iDialogHideAniCore"][r-1],u=v||g.noop,n=function(){p.removeClass(o)[r==1?"show":"hide"]();u()};if(!p||!p[0]){return u()}p.css("visibility","visible");if(!s||(s>2&&i)){p[r==1?"show":"hide"]();return u()}if(s<3){r==1?p.hide()[s==1?"fadeIn":"slideDown"](200,u):p.show()[s==1?"fadeOut":"slideUp"](200,u);return}q="iDialogAnimate"+s;if(r==1){p.one(a,n).addClass(q);j.setTimeout(function(){p.addClass(o).removeClass(q)},10)}else{p.one(a,n).addClass(o);j.setTimeout(function(){p.addClass(q)},10)}},closeAll:function(){g.each(d.cache,function(o,n){n.close()})}};var k=Class.Base.Event.extend("Widgets.Dialog",{init:function(n,q){this.callSuper("onCreate onShow onBeforeClose onClose onDestroy onBtnClick");var p=d.checkOptions(n||{},q),o=this;if(p.layout){this.layout=m.create({zindex:d.zindex.model++,type:p.layout,animate:p.animate?1:0}).onDestroy(function(){o.layout=null}).onClick(function(){if(this.opacityZero){o.flash()}});p.zindex=d.zindex.model++}else{this.layout=null;p.zindex=d.zindex.modeless++}this.id="iDialog"+d.guid++;this.cache=d.prepareDoms(this.id,p);this.options=p;this.returnValue=null;this.wrap=this.cache.wrap.css("visibility","visible");this.title(true);this.width(p.width).height(p.height);this.content(p.content,p.type,true);this.wrap.css("visibility","hidden");d.bindMoveTop(this);d.focusBtn(this);d.bindParaEvent(this);p.dragable&&this.bindDrag();p.timeout&&j.setTimeout(function(){o.close()},p.timeout);d.cache[this.id]=this;d.checkShortCut();j.setTimeout(function(){o.trigger("onCreate",o);d.animate(o.wrap,1,p.animate,function(){o.trigger("onShow",o);g.sendMsg(50,"dialog.show",d.getCacheInfo())})},0)},flash:function(){var o=this.wrap,n=0,p=2*6,q=j.setInterval(function(){o[n%2?"removeClass":"addClass"]("iDialogFlash");++n>=p&&j.clearInterval(q)},100);return this},content:function(s,w,q){if(typeof(w)==="boolean"){q=w;w="html"}w=w||"html";if(!s&&s!==""){return this}var n=this.cache,o=n.wrap,t=this,p=d.updateDom,u;d.revertDom(this);switch(w){case"html":case"text":p(n.main||o,w,s);break;case"shell":n.main=n.content=null;if(n.ground[0]){u=n.ground.clone()}p(o,"html",s);break;case"insert":case"agent":var v=d.markDom(s);if(!v){this.content("没有找到页面内容（"+s+"）请检查！")}else{if(w=="agent"||!n.main){this.content(v,"shell")}else{p(n.main,"html",v)}n.orgDom=v}break}if(o.find("iframe:visible").length&&!o.find(".iDialogDragLayoutHelper").length){o.append('<div class="iDialogDragLayoutHelper"></div>')}if(u){o.prepend(u);n.ground=u;d.fixIframeGround(this)}this.button=g(".iDialogBtn",o);try{this.button.setControlEffect("iDialogBtnDown");this.cache.closeBtn.setControlEffect("iDialogCloseDown")}catch(r){}d.bindBtnClick(this);q&&this.position(true);return this},position:function(n){if(n===c){return this.options.position}if(n===true){n=this.options.position}this.options.position=n;this.wrap.css(g.extend({left:"",top:"",bottom:"",right:"",marginTop:"",marginLeft:""},d.calPosition(n||0,this.width(),this.height(),this.wrap.css("position"))));return this},unbindDrag:function(){d.unbindDrag(this);return this},bindDrag:function(o){var n=this.options;o=o||n.dragable||1;this.unbindDrag();var p=d.bindDrag(this.wrap,o);if(p){this.warn(p)}n.dragable=o;return this},title:function(p){if(p===c){return this.options.title}if(p===true){p=this.options.title}var o=this.cache,n="iDialogNoTitle";if(o.title&&o.title[0]){if(p===""||p===null){o.title.addClass("hide");o.closeBtn[p===null?"addClass":"removeClass"]("hide");this.wrap.addClass(n)}else{o.title.removeClass("hide").find("h1").html(p);o.closeBtn.removeClass("hide");this.wrap.removeClass(n)}}this.options.title=p;return this},height:function(o){var p=this.cache,q=p.wrap.height(),n=p.main,r=p.wrap;if(o===c){return q}o=parseInt(o,10)||0;if(o===0){(n||r).css("height","auto")}else{if(o){if(n){n.height(Math.max(o-(q-n.height()),50))}else{r.height(Math.max(50,o))}}}d.fixIframeGround(this);return this},width:function(o){var n=this.cache;if(o===c){return n.wrap.width()||n.wrap.width()}o=parseInt(o,10)||0;if(o===0){n.wrap.css("width","auto").addClass("autoWidthDialog")}else{if(o){n.wrap.removeClass("autoWidthDialog").width(Math.max(o,200))}}d.fixIframeGround(this);return this},close:function(o){if(this.closing||this.closed){return}var p=o===c?this.returnValue:o,n=this;if(this.trigger("onBeforeClose",p)===false){return}this.returnValue=p;this.closing=true;d.checkShortCut();this.layout&&this.layout.destroy();d.animate(this.wrap,2,this.options.animate,function(){n.closed=true;n.wrap.hide();n.trigger("onClose",p);d.revertDom(n);d.updateDom(n.wrap,"html","");n.wrap.empty().remove();delete d.cache[n.id];delete n.cache;delete n.wrap;delete n.button;delete n.options;if(e){l.body.className=l.body.className}n.trigger("onDestroy",p);g.sendMsg(50,"dialog.hide",d.getCacheInfo());d.focusBtn()})},toString:function(){return this.id}});k.prototype.destroy=k.prototype.close;k.closeAll=k.destroyAll=d.closeAll;g.bindMsg("dialog.show",function(n){g.sendMsg("dialog.change",1,n)});g.bindMsg("dialog.hide",function(n){g.sendMsg("dialog.change",0,n)});g.dialog=function(n,p){if(n===c){return k.closeAll()}if(n.constructor===k||(typeof n=="string"&&d.cache[n])){(n.close?n:d.cache[n]).close(p);return}if(typeof n==="string"){if(/^iDialog\d+$/.test(n)){return}var o=n.indexOf(".")===0?n.substr(1):"";if(o){g.each(d.cache,function(r,q){if(q.wrap.hasClass(o)){q.close(p)}});return}else{n={content:n}}}return k.create(n,p)};g.each({alert:function(o,n,p){return k.info(o,n,p,0,"iDialogAlert")},confirm:function(o,n,p){return k.info(o,n,p,["*确定","取消"],"iDialogConfirm")},error:function(o,n,p){return k.info(o,n,p,0,"iDialogError")},info:function(r,q,s,o,n){if(g.isFunction(q)){s=q;q=0}var p=q||o||["*确定"];return k.create({title:null,css:n||"iDialogInfo",content:r,dragable:2,button:p},s)},toast:function(n,o,p){if(g.isFunction(o)){p=o;o=0}return k.create({title:null,css:"iDialogToast",content:n,button:[],layout:-1,position:{bottom:"30%"},timeout:o||2500,animate:16},p).onCreate(function(){this.layout.destroy()})}},function(o,n){k[o]=g.dialog[o]=n})});