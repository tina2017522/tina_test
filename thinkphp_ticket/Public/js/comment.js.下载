(function(b,c,e,d){var a=e;if(a.isInFrame){a.mailApp="/mailapp";a.mailTarget="_self";a.mailAppOrder="/mailapp"}else{a.mailApp="";a.mailAppOrder="";a.mailTarget="_blank"}c.extend(e,{writeSCmtEvent:function(){var f=e;if(!f.easyNav.isLogin(true)){f.login(f.urlAddHash("tab","comment"));return}if(!f.movieId){return}f.commentDialog(0)},sendComment_S:function(){var j=e,h=j.easyNav;if(!j.easyNav.isLogin(true)){j.login(j.urlAddHash("tab","comment"));return}if(!j.movieId){return}var o=c(this).parent().parent(),g=o.find(">.comm_area"),k=o.find(".err");msg=g.val();if(msg=="亲，说两句吧~"){g.focus().removeClass("textGray").val("");k.text("您还没输入影评内容呢！").removeClass("hide2");return false}var m=msg.length;if(m<6||m>300){g.focus();k.text("影评字数不够6字哟！").removeClass("hide2");return false}var n="^(http://|ftp://|https://|www){0,1}[^\u4e00-\u9fa5\\s]*?\\.(com|net|cn|me|tw|fr)[^\u4e00-\u9fa5\\s]*$";var p=new RegExp(n);if(p.test(msg)){k.text("影评内容不允许包含链接!").removeClass("hide2");return false}if(c("#sinaWeiBoCbx")[0].checked){var f="http://v.t.sina.com.cn/share/share.php?url={url}&title={title}&searchPic=true";this.href=c.format(f,{url:encodeURIComponent(document.URL+"#from=t.sina"),title:encodeURIComponent(msg)})}k.addClass("hide2");var l=o.find(".sub");var i={req_id:j.movieId,req_type:"movie",postType:1,category:5,text:encodeURIComponent(msg)};c.ajax({dataType:"jsonp",url:"http://qz.dianying.163.com/w/req_sendPosts",data:i,success:function(q){q=typeof q=="object"?q:j.parseJSON(q);switch(+q.result){case 100:j.showDialog('<div class="commDialog_result"><a href="javascript:;" class="closeBtn closePop"></a><b></b><h3>感谢你的评论！</h3> <a class="btn closePop mt20" href="javascript:;">确认</a></div>');var s=c("#sCommentList"),r=c("#noShortPart");s.prepend(c.format('<dd {0}><div class="infor"><div class="name">{1}</div><div class="time">{2}</div></div> <div class="detail">{3}</div></dd>',s.find("li").length?"":" class='last'",q.nickname||"",j.formatCreatTime(q.date),c.safeHTML(q.text)));var t=c("#commCount_S").find("em").text();c("#commCount_S").find("em").text((+t)+1);if(r.length){r.remove()}break;case 202:j.showDialog('<div class="commDialog_result commDialog_fail"><a href="javascript:;" class="closeBtn closePop"></a><b></b><p class="msg">您的评论含有不合法字符！</p> <a class="btn closePop" href="javascript:;">确认</a></div>');break;case 205:j.showDialog('<div class="commDialog_result commDialog_fail"><a href="javascript:;" class="closeBtn closePop"></a><b></b><p class="msg">您今天发表的评论太多啦！明天再来吧！</p> <a class="btn closePop" href="javascript:;">确认</a></div>');break;case 207:j.showDialog('<div class="commDialog_result commDialog_fail"><a href="javascript:;" class="closeBtn closePop"></a><b></b><p class="msg">您的评论不能包含链接！</p> <a class="btn closePop" href="javascript:;">确认</a></div>');break;case 421:j.login(j.urlAddHash("tab","comment"));break;default:j.showDialog('<div class="commDialog_result commDialog_fail"><a href="javascript:;" class="closeBtn closePop"></a><b></b><p class="msg">'+q.resultDesc+'</p> <a class="btn closePop" href="javascript:;">确认</a></div>')}},error:function(q){q=typeof q=="object"?q:j.parseJSON(q);j.showDialog('<div class="commDialog_result commDialog_fail"><a href="javascript:;" class="closeBtn closePop"></a><b></b><p class="msg">'+(!!q&&!!q.resultDesc?q.resultDesc:"您的网络链接有问题，请稍后重试")+'</p> <a class="btn closePop" href="javascript:;">确认</a></div>')}})},commentDialog:function(h,i){var f=e;if(!f.movieId){return}var g=c(['<div class="commDialog">','<a href="javascript:;" class="close"></a>','<ul id="typeTab" class="typeTab"><li class="active" rel="#commDialog_S">发表新影评</li></ul>','<div id="commDialog_S" class="commDialog_S">','<p>评论要求6 - 300字，您还可以输入 <em class="num">300</em> 字 </p>','<textarea class="comm_area textGray" rows="" cols="" name="message" maxlength="300" onkeyup="this.value = this.value.substring(0,300)">亲，说两句吧~</textarea>','<div class="note">','<div id="shareComment" class="shareComment">同步到：','<input type="checkBox" id="sinaWeiBoCbx" checked="checked" />','<label for="sinaWeiBoRadio">','<a target="_blank" title="新浪微博" href="javascript:;" rel="sinaweibo" class="cpShareLink">','<em class="cpShareIcon sinaweibo"></em>新浪微博</a></label>',"</div>",'<a rel="1" class="sub" href="javascript:;" target="_blank">发表</a>','<span class="err hide2">影评字数不够6字哟！</span>',"</div></div>"].join(""));c.dialog();c.dialog({title:"",content:g.get(0),width:0,css:i||"",animate:0,button:[],init:function(){c(".iDialogClose").remove();var j=e,n=c("#typeTab"),k=c(".commDialog",this),p=k.find(".commDialog_S");c("#typeTab").bindTab(function(){if(c(this).attr("rel")=="#commDialog_L"){j.long_comment_check()}},"click");k.find(">.close").click(function(){c.dialog()});var o=p.find("[name=message]"),m=p.find(".sub"),l=p.find(".err");j.focusBlurTip(o,"亲，说两句吧~");o.keyup(function(){p.find(".num").text(300-this.value.length);l.html("").addClass("hide")});m.click(j.sendComment_S)}})},showDialog:function(f){e.showDialogFunc({content:f,width:450,init:function(){c(".iDialogClose").remove();c(".closePop,this").click(function(){c.dialog()})}})},urlAddHash:function(g,h){var f=document.URL;if(f.indexOf("#")==-1){f+="#"+g+"="+h}else{f+="&"+g+"="+h}return f}})})(window,jQuery,Core);