(function(e,b,d){var j=e.document,q=null,s=0,o=[],f={listID:"autoCompleteList",itemCss:"autoListItem",itemHover:"autoListItemHover"},p={noResult:"noResult",loseFocus:"loseFocus",noInitFocus:"noResultWhenFocus",oneSame:"oneSame",inputCfm:"inputConfirm",force:"scriptForce"},c=function(){return b(j.getElementById(f.listID)||b("<div id='"+f.listID+"'/>").appendTo(j.body).delegate("a","mouseenter",i.autoListHover).delegate("a","mousedown",i.autoListClick)[0])},m=function(w,v){return String(w).replace(/\{([\w]+)\}/g,function(y,x){var A=x.split("."),B=v;for(var z=0;z<A.length;z++){B=B[A[z]]}return B===d?y:B})},l=function(v){return String(v).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},i={autoListHover:function(z,x){b("#"+f.listID).find("."+f.itemHover).removeClass(f.itemHover);var y=b(this).addClass(f.itemHover),v=q,w;if(x===true&&v&&z.type=="keydown"){if(this===null||this===e){v.val(v[0].orgValue);v[0].orgValue=null}else{v[0].orgValue=v[0].orgValue||v.val();v.val(this.title)}}},autoListClick:function(x){if(!x){q[0].ignoreOnceKeyup=true}var v=this.title,w=this.hash.substr(1)||b(this).attr("href");q.val(v).attr("val",w);i.hideList(p.inputCfm,v,w,this);x&&x.preventDefault()},docKeyDown:function(C){var A=c(),B=C.keyCode,z,y,w,x,v;if(!A.is(":visible")||q===null){return}y=A.find("."+f.itemHover);x=o[q[0].autoCompleteId];v=x.emptyHolder;switch(B){case 38:case 40:w=A.find("."+f.itemCss+":"+(B==38?"last":"first"));z=y[0]?y[B==38?"prev":"next"]("."+f.itemCss):w;z=z[0]?z:v?[null]:w;i.autoListHover.call(z[0],C,x.pushValue);C.preventDefault();break;case 13:y[0]&&i.autoListClick.call(y[0]);return false}},docMouseDown:function(){if(q!==null){i.hideList(p.loseFocus,q.val(),q.attr("val"))}},recalTip:function(){var w=q,y,v,x=c();if(w){v=o[w[0].autoCompleteId];y=w.offset();y.height=w.outerHeight();v.sameWidth&&x.width(w.outerWidth()-x.outerWidth()+x.innerWidth());x.css({left:y.left,top:y.top+y.height}).show()}},showListFor:function(y,x){var w,v=y,z=c(),B,A=!q;if(q!==null&&q[0]!==v[0]){A=true;this.hideList(p.loseFocus,q.val(),q.attr("val"))}v.attr("autocomplete","off");if(A){w=o[v[0].autoCompleteId];q=v;b(j).keydown(this.docKeyDown).mousedown(this.docMouseDown);w.listCss&&z.addClass(w.listCss);this.recalTip();b(e).resize(this.recalTip).scroll(this.recalTip);w.onShow.call(v[0],!!x)}},hideList:function(v,A,z,y){var x=q,w;if(x===null){return}x[0].orgValue=null;q=null;b(j).unbind("keydown",this.docKeyDown).unbind("mousedown",this.docMouseDown);c().removeAttr("style").removeClass();b(e).unbind("resize",this.recalTip).unbind("scroll",this.recalTip);w=o[x[0].autoCompleteId];w.onHide.call(x[0],v,A,z,y)}},t=function(y,w,x){var v=c();w.onShow=w.onShow||b.noop;w.onHide=w.onHide||b.noop;w.sameWidth=!!w.sameWidth;w.emptyHolder=!!w.emptyHolder;w.pushValue=!!w.pushValue;w.checkValid=w.checkValid||b.noop;return y.each(function(){if(this.autoCompleteId!==d){return}var B=s++,A=b(this),D="",z=w||{};this.autoCompleteId=B;o[B]=z;var C=function(G){var F=z.isValid==d?true:z.isValid;if(z.checkValid()===false){if(F){i.hideList(p.force)}z.isValid=false;return}if(this.ignoreOnceKeyup){this.ignoreOnceKeyup=0;return}var E=b.trim(this.value),H=G.keyCode>=37&&G.keyCode<=40;if(E===D||(this.orgValue==D&&H)){return}G.value=D=E;this.orgValue=null;x.call(this,G,z,function(J,I){if(J){v.html(J);if(!z.emptyHolder){v.find("."+f.itemCss+":first").addClass(f.itemHover)}i.showListFor(A)}else{if(J!==0&&E&&z.noResult&&G.type=="keyup"){v.html(z.noResult.replace(/{key}/g,l(E)));i.showListFor(A,true)}else{i.hideList({keyup:I||(J===0?p.oneSame:p.noResult),focus:p.noInitFocus}[G.type],E,A.attr("val"))}}})};A.bind({keyup:C,blur:function(E){D="";i.hideList(p.loseFocus,this.value,b(this).attr("val"))},focus:function(F){var E=this;this.orgValue=E.value;e.setTimeout(function(){C.call(E,F)},16)}})})};b._autoComplete=t;b.safeRegStr=function(v){return String(v).replace(/([\\\(\)\{\}\[\]\^\$\+\-\*\?\|])/g,"\\$1")};b.hideAutoComplete=function(){i.hideList("force")};var g=function(F,v,J){var H=F.value,G=v.dataList,w=v.split||G[0].substr(0,1),A=H.split(w),x=A[0],y=A.length>1?w+A[1]:"",E=[],D,I=!y?G:(function(){var K=[],M=G.length,L=0;for(;L<M;L++){G[L].toLowerCase().indexOf(y)>=0&&K.push(G[L])}return K})(),B=false;if(v.canShowNormal){if(b.isFunction(v.canShowNormal)){B=v.canShowNormal(H)}else{if(Object.prototype.toString.apply(v.canShowNormal)==="[object RegExp]"){B=v.canShowNormal.test(H)}}}if(B){I=[""].concat(I)}if(I.length==0||!x){J(null);return}if(I.length==1&&y==I[0]){J(0);return}D={itemCss:f.itemCss,base:l(x)};for(var C=0,z=I.length;C<z;C++){D.ext=I[C];D.text=l(x)+I[C];E[C]=m(v.itemTmpl,D)}J(v.headTmpl+E.join("")+v.footTmpl)},u={headTmpl:"<div>请选择或继续输入...</div>",itemTmpl:"<a class='{itemCss}' href='#{text}' title='{text}'>{base}<i>{ext}</i></a>",footTmpl:"",listCss:"autoFill",canShowNormal:null};b.fn.autoFill=function(x,v){var w=b.extend({},u,v||{});w.dataList=x;return t(this,w,g)};var k=function(z,v,B){var A=z.value,C=a(v.dataList,A,v.maxResultNum),w=C.length,x=0,D=w==0?w:w==1&&C[0].x==A?-1:w,y=[];v.onMatch.call(this,D,C);if(w==0){B(null);return}if(D<0){B(0);return}for(;x<w;x++){C[x].itemCss=f.itemCss;y[x]=m(v.itemTmpl,C[x])}B(v.headTmpl+y.join("")+v.footTmpl)},a=function(E,H,J){if(!H){return[]}var D=[],w=[],C=[],A=[],x=E.length,B=0,K,y,I=b.safeRegStr,v=function(M,N,L){return b.extend({xShow:N?M.x.replace(N,"<b>$1</b>"):M.x,yShow:L&&M.y?M.y.replace(L,"<b>$1</b>"):M.y},M)},z=new RegExp("("+I(H)+")","i"),G=new RegExp("^("+I(H)+")","i"),F=new RegExp("^"+H.replace(/./gi,function(L){return"("+I(L)+").*"}),"i");for(;B<x;B++){K=E[B];if(!K||!K.x||K.v===d){continue}if(z.test(K.x)){w[K.x===H?"unshift":"push"](v(K,z));continue}else{if(K.z&&z.test(K.z)){w.push(v(K));continue}else{if(K.y&&G.test(K.y)){C.push(v(K,0,G));continue}else{if(K.y&&F.test(K.y)){A.push(v(K))}}}}}if(C.length){A.length=0}D=w.concat(C,A);if(D.length){D=D.slice(0,Math.min(J||10,D.length))}return D},n={headTmpl:"",itemTmpl:'<a class="{itemCss}" href="#{v}" title="{x}"><span>{xShow}</span><i>({yShow})</i></a>',footTmpl:"",listCss:"autoMatch",noResult:'No Match "<b>{key}</b>"!',maxResultNum:10};b.fn.autoMatch=function(x,v){var w=b.extend({},n,v||{});w.dataList=x;w.onMatch=w.onMatch||b.noop;return t(this,w,k)};var h=function(z,w,E){if(!z.value){E(null);return}if(w.cache&&w._t[z.value]!==d){E(w._t[z.value]);return}var D=z.value,y=[],v=+new Date(),B="cb"+v,C=j.getElementsByTagName("head")[0]||j.documentElement,x=j.createElement("script"),A=this;x.type="text/javascript";x.src=m(w.suggest,{cache:v,key:encodeURIComponent(D),callback:"window."+B});e[B]=function(){C.removeChild(x);var G=arguments,M,I=0,H=[],K=f,L=m,J=w.trans.apply(A,G),F=null;if(b.isArray(J)){M=J.length;if(M==0){E(null);return}for(;I<M;I++){J[I].itemCss=K.itemCss;H[I]=L(w.itemTmpl,J[I])}F=w.headTmpl+H.join("")+w.footTmpl}E(F);if(w.cache){w._t[z.value]=F}e[B]=null};C.appendChild(x,C.lastChild)},r={headTmpl:"",itemTmpl:'<a class="{itemCss}" href="#{value}" title="{text}">{textShow}</a>',footTmpl:"",listCss:"autoSearch",cache:true,emptyHolder:true,pushValue:true};b.fn.autoSearch=function(w,v,x){var y=b.extend({},r,x||{});y.suggest=w;y.trans=v;y._t={};return t(this,y,h)}})(window,jQuery);