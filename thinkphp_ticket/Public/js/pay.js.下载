(function(a,b,c){c.navConfig.logoutUrl="/logout.html";b.extend(c,{myInit:function(){var d=c;if(b("#methodBox").is(":hidden")){d.showBox="methodUserBox"}if(b("#methodUserBox").is(":hidden")){d.showBox="methodBox"}if(d.isInFrame){d.mailApp="/mailapp";d.mailAppOrder="/mailapp"}else{d.mailApp="";d.mailAppOrder=""}b("#payTab").bindTab("click");this.warming();this.showAll();this.subPay();this.timerStar(this.closeTime);if(d.invalideCodes&&d.invalideCodes.length>0){var e=d.invalideCodes.join("，");b.dialog({title:"",width:500,button:["返回首页","*继续支付"],css:"rebate_dialog",content:'<div class="payMeg" style="padding-bottom:0;"><div class="main" style="text-align:center;font-size:14px;padding:40px 0px;"><div>兑票码'+e+"不可以重复使用哦！</div>您可以按优惠价继续支付，也可以回到首页，更换兑票码重新兑票！</div></div>",beforeClose:function(g){if(g==1){d.post("/order/close_order.html?order_id="+b("#order_id").val().trim(),function(i,h){if(d.isInFrame){a.location.href="http://piao.163.com/promoter/mail_126.html"}else{a.location.href="http://piao.163.com"}})}}})}if(d.isUsingRC!=1){this.initFav();d.check_flag=0,d.check_out=0;this.showCodeText()}b("body").delegate("#checkExchange","click",this.chargeBefore).delegate("#pay_btn_01","click",function(){var g=b("#displayGorderId").val().trim();a.location.href="http://order.mall.163.com"+c.mailAppOrder+"/movie/list.html?gorderId="+g}).delegate("#nopay_btn_01","click",function(){var g=b("#displayGorderId").val().trim();a.location.href="http://order.mall.163.com"+c.mailAppOrder+"/movie/list.html?gorderId="+g}).delegate("#pay_btn_02","click",function(){if(d.isInFrame){a.open("http://mall.163.com/help/movie.html")}else{a.location.href="http://mall.163.com/help/movie.html"}});b("#payUserEdit").click(function(){c.editPayMethod()});b("#payEdit").click(function(){c.editPayMethod()});b("#cancleEdit").click(function(){c.cancelPayMethod()});b("#closeEdit").click(function(){c.cancelPayMethod()});b("#sureEdit").click(function(){c.surePayMethod()});if(b("input:radio[name=use_radio]")[0]){this.selCodeType()}d.userFavTextVal="";d.statistics_adsage()},selCodeType:function(){b("input:radio[name=use_radio]").click(function(){var d=c;if(!d.easyNav.isLogin()){d.login();return false}if(b(this).val()==0){b("#userFavSel").show();b("#fav_sel_err").show();b("#userFavText").hide();b("#fav_err").hide();b("#coupon_num").attr("class","coupon_num");if(b("#userFavSel").is("select")){var e=b("#userFavSel").val().trim();if(e.length==10&&e!="0000000000"){d.checkFavText()}else{d.favPc=0;d.calPrice()}}}else{b("#userFavText").show();b("#fav_err").show();b("#userFavSel").hide();b("#fav_sel_err").hide();b("#coupon_num").attr("class","coupon_num");if(b("#userFavText").is("input")){var e=b("#userFavText").val().trim();if(e.length==10&&e!="输入十位优惠码"){d.checkFavText()}else{if(e!="输入十位优惠码"){d.favPc=0;d.calPrice();d.showFavTextErr(2,"优惠码是10位哦！")}else{d.favPc=0;d.calPrice()}}}}})},editPayMethod:function(){if(!c.easyNav.isLogin()){c.login();return false}var g=document.documentElement.scrollWidth;var e=document.documentElement.scrollHeight;var d=(document.documentElement.clientHeight-b("#payment")[0].clientHeight)/2+document.documentElement.scrollTop;b("#cover").css({width:g,height:e}).show();b("#payment").css({top:d,visibility:"visible"});if(b.isIE6&&b("#userFavSel")[0]&&b("#userFavSel").is("select")){b("#userFavSel").css("visibility","hidden")}},cancelPayMethod:function(){b("#cover").hide();b("#payment").css({visibility:"hidden"});if(b.isIE6&&b("#userFavSel")[0]&&b("#userFavSel").is("select")){b("#userFavSel").css("visibility","visible")}},surePayMethod:function(){var d=b("input:[name='paymethodList']:checked").val();if(!d.trim()){b("#bankImg").removeClass().addClass("bank_img bank_0000")}else{b("#bankImg").removeClass().addClass("bank_img bank_"+d)}b("#cover").hide();b("#payment").css({visibility:"hidden"});b("input[name='paymethod']").val(d);b("#methodBox").hide();b("#methodUserBox").show();c.showBox="methodUserBox";if(b.isIE6&&b("#userFavSel")[0]&&b("#userFavSel").is("select")){b("#userFavSel").css("visibility","visible")}},showCodeText:function(){if(b("#showText")[0]){var d=c;b("#showText").click(function(){c.checkBefore()})}},checkBefore:function(){c.post("/order/code_check_before.html",function(g,e){if(!g&&e){var d=c;e=d.parseJSON(e);if(b.isIE6&&b("#userFavSel")[0]&&b("#userFavSel").is("select")){b("#userFavSel").css("visibility","hidden")}switch(+e.retcode){case 200:if(e.needCheck){d.showDialogCom(0,'<div class="meg"><div class="close"></div><ul><li><span class="th">请输入优惠码：</span><input type="text" class="text" id="codeText" maxlength="10"/></li><li><span class="th"></span><span class="err" id="codeErr"></span></li><li><span class="th">请输入验证码：</span><input type="text" class="text" style="width:93px;" id="checkNum" maxlength="4"/><img src="'+e.checkCodeUrl+'" width="95" height="26" alt="" class="ml10" id="checkNumImg"/></li><li><span class="th"></span><span class="err" id="checkErr"></span></li><li><span class="th"></span><input type="button" value="兑换" class="btn_meg_charge" id="checkExchange"/></li></ul></div>');check_out=0;check_flag=1;d.initCode()}else{d.showDialogCom(0,'<div class="meg" id="initMeg"><div class="close"></div><ul><li><span class="th">请输入优惠码：</span><input type="text" class="text" id="codeText" maxlength="10"/><input type="button" value="兑换" class="btn_meg_charge ml8" id="checkExchange"/></li><li><span class="th"></span><span class="err" id="codeErr"></span></li></ul></div>');check_out=1;check_flag=0;d.initCode()}break;case 410:check_flag=0;d.showDialogCom(1,'<div class="movieDialog"><h2><b></b>优惠码格式错误，请重新输入！</h2></div>');break;default:check_flag=0;d.showDialogCom(1,'<div class="movieDialog"><h2><b></b>出错了~</h2></div>')}}})},checkCode:function(){var g=b("#codeText").val().trim(),e=0;if(b("#checkNum")[0]){var d=b("#checkNum").val().trim()}if(check_flag==1){e=1}c.post("/order/my_code_check.html",{code:g,need_check_code:e,check_code:d},function(n,l){if(!n&&l){var k=c;l=k.parseJSON(l);switch(+l.retcode){case 200:b.dialog();var j=b("#userFav"),i=b("#userFavText"),m="";if(!j.attr("checked")){j.attr("checked",true);i.attr("disabled",false)}if(!b('#userFavText option[value="'+l.codeVo.code+'"]')[0]){m='<option value="'+l.codeVo.code+'">'+l.codeVo.codeName+"</option>";b("#userFavText option:eq(0)").after(m);i.val(l.codeVo.code);k.checkFavText()}else{i.val(l.codeVo.code);k.checkFavText()}break;case 203:if(l.needCheck&&check_out){var h=b("#codeText").val();b.dialog();b("#initMeg").remove();k.showDialogCom(2,'<div class="meg"><div class="close"></div><ul><li><span class="th">请输入优惠码：</span><input type="text" class="text" id="codeText" maxlength="10" value="'+h+'"/></li><li><span class="th"></span><span class="err" id="codeErr">优惠码不正确，请重新输入！</span></li><li><span class="th">请输入验证码：</span><input type="text" class="text" style="width:93px;" id="checkNum" maxlength="4"/><img src="'+l.checkCodeUrl+'" width="95" height="26" alt="" class="ml10" id="checkNumImg"/></li><li><span class="th"></span><span class="err" id="checkErr"></span></li><li><span class="th"></span><input type="button" value="兑换" class="btn_meg_charge" id="checkExchange"/></li></ul></div>');check_flag=1;k.initCode()}else{b("#codeErr").html("优惠码不正确，请重新输入！");if(l.needCheck){b("#checkNumImg").attr("src",l.checkCodeUrl)}}break;case 204:b("#checkErr").html(l.retdesc);b("#checkNumImg").attr("src",l.checkCodeUrl);break;case 205:b("#checkErr").html(l.retdesc);b("#checkNumImg").attr("src",l.checkCodeUrl);break;case 410:if(l.needCheck&&check_out){var h=b("#codeText").val();b.dialog();b("#initMeg").remove();k.showDialogCom(2,'<div class="meg"><div class="close"></div><ul><li><span class="th">请输入优惠码：</span><input type="text" class="text" id="codeText" maxlength="10" value="'+h+'"/></li><li><span class="th"></span><span class="err" id="codeErr"></span></li><li><span class="th">请输入验证码：</span><input type="text" class="text" style="width:93px;" id="checkNum" maxlength="4"/><img src="'+l.checkCodeUrl+'" width="95" height="26" alt="" class="ml10" id="checkNumImg"/></li><li><span class="th"></span><span class="err" id="checkErr">登录超时或尚未登录!</span></li><li><span class="th"></span><input type="button" value="兑换" class="btn_meg_charge" id="checkExchange"/></li></ul></div>');check_flag=1;k.initCode()}else{b("#codeErr").html("登录超时或尚未登录！");if(l.needCheck){b("#checkNumImg").attr("src",l.checkCodeUrl)}}break;default:if(l.needCheck&&check_out){var h=b("#codeText").val();b.dialog();b("#initMeg").remove();k.showDialogCom(2,'<div class="meg"><div class="close"></div><ul><li><span class="th">请输入优惠码：</span><input type="text" class="text" id="codeText" maxlength="10" value="'+h+'"/></li><li><span class="th"></span><span class="err" id="codeErr"></span></li><li><span class="th">请输入验证码：</span><input type="text" class="text" style="width:93px;" id="checkNum" maxlength="4"/><img src="'+l.checkCodeUrl+'" width="95" height="26" alt="" class="ml10" id="checkNumImg"/></li><li><span class="th"></span><span class="err" id="checkErr">系统异常，请重新输入!</span></li><li><span class="th"></span><input type="button" value="兑换" class="btn_meg_charge" id="checkExchange"/></li></ul></div>');check_flag=1;k.initCode()}else{b("#codeErr").html("系统异常，请重新输入！");if(l.needCheck){b("#checkNumImg").attr("src",l.checkCodeUrl)}}}}})},initCode:function(){var d=b("#codeText");d.keyup(function(){var e=d.val().replace(/[^0-9a-zA-Z]/g,"").trim();if(e!=this.value){this.value=e}b("#codeErr").html("")}).blur(function(){var e=d.val().replace(/[^0-9a-zA-Z]/g,"").trim();if(e!=this.value){this.value=e}}).focus(function(){b("#codeErr").html("")});if(b("#checkNum")[0]){b("#checkNum").focus(function(){b("#checkErr").html("")}).click(function(){b("#checkErr").html("")}).keyup(function(){b("#checkErr").html("")})}},chargeBefore:function(){var h=b("#codeText"),d=b("#checkNum");if(h[0]){var g=h.val().trim();if(g==""){b("#codeErr").html("请输入优惠码！");return false}if(g.length<10){b("#codeErr").html("请输入10位优惠码！");return false}}if(d[0]){var e=d.val().trim();if(e==""){b("#checkErr").html("请输入验证码！");return false}if(e.length<4){b("#checkErr").html("请输入4位验证码！");return false}}c.checkCode()},warming:function(){b("#telWarming").hover(function(){b(this).parent().addClass("active")},function(){b(this).parent().removeClass("active")})},calPrice:function(g){var h=b("#totalPrice").text().replace(/[^0-9\.]/g,""),d=b("em","#favPrice"),i=this.favPc,j,e=c;if(g&&g==1){i=0}d.html(i?i:0);j=(Number(h)-i).Round(2);j=j>0?j:0;b("#totalFavPrice").html("¥"+j);b("#scoreNum").text(Math.ceil(j));if(j==0){b("#methodBox").hide();b("#methodUserBox").hide();b("#exchangeBox").show();c.noPay=true}else{b("#methodBox").hide();b("#methodUserBox").hide();b("#exchangeBox").hide();b("#"+e.showBox).show();c.noPay=false}},initFav:function(){var d=b("#userFavText"),g=b("#userFavSel"),e=b("#favTip");if(parseFloat(b("#totalPrice").text().replace(/[^0-9\.]/g,""))<=10){b("#coupon_num").hide();f=0}else{b("#coupon_num").show()}if(d.length>0){this.focusBlurTip(d,"输入十位优惠码")}g.change(this.favTextCheck);d.focus(this.favTextFocus).blur(this.favTextBlur).change(this.favTextCheck).keyup(this.favTextCheck).disableDarg().bind("paste",function(){var h=this;a.setTimeout(function(){c.favTextCheck.call(h)},100)})},favTextFocus:function(){if(this.value.length<10){c.showFavTextErr()}},favTextBlur:function(){var d=this.value.trim();if(!d||d=="输入十位优惠码"){c.userFavTextVal="";return}if(this.value&&this.value.length<10){c.showFavTextErr(2,"优惠码是10位哦！")}},favTextCheck:function(h){var g=this.value.replace(/[^a-zA-z0-9]/g,""),d=c;if(g!=this.value){this.value=g}if(b(this).is("select")&&g=="0000000000"){g=+g;d.userFavTextVal=""}if(!g||g.length<10){d.favPc=0;d.calPrice();d.showFavTextErr()}else{if(g!=d.userFavTextVal){d.userFavTextVal=g;d.checkFavText()}}},favPc:0,checkFavText:function(){var d=b("#order_id").val();if(b("input:radio[name='use_radio'][checked]").val()==0){var e=b("#userFavSel").val().replace(/[^a-zA-z0-9]/g,"")}else{if(b("input:radio[name='use_radio'][checked]").val()==1){var e=b("#userFavText").val().replace(/[^a-zA-z0-9]/g,"")}else{var e=""}}c.post("/order/check_code.html",{code:e,order_id:d},function(i,h){if(!i&&h){var g=c;h=g.parseJSON(h);switch(+h.retcode){case 200:if(h.codeValid){g.showFavTextErr(1);g.favPc=h.codeAmount}break;default:g.favPc=0;g.showFavTextErr(2,!!h.retdesc.trim()?h.retdesc:"这个码不正确啦~")}g.calPrice()}})},showFavTextErr:function(i,e){var h="coupon_num",g=0,d=b("#userFavText");switch(i){case 1:h+=" coupon_num_true";g=1;break;case 2:h+=" coupon_num_error";break;default:break}b("#code").data("flag",g);if(b("input:radio[name='use_radio'][checked]").val()==0){b("#fav_sel_err").text(e||"")}else{if(b("input:radio[name='use_radio'][checked]").val()==1){b("#fav_err").text(e||"")}}b("#coupon_num")[0].className=h},showAll:function(){b(".showAllBank").click(function(){if(b(this).siblings(".otherBank").has("other")){b(this).siblings(".otherBank").removeClass("other");b(this).hide()}})},subPay:function(){var d=c;if(b("#btnAgree1").length){b("#btnAgree1").attr("checked",true);b("#btnAgree1").click(function(){if(b(this).attr("checked")){b("#subPay1").removeClass("disabled");b("#subPay1").attr("disabled",false)}else{b("#subPay1").addClass("disabled");b("#subPay1").attr("disabled",true)}})}if(b("#btnAgree2").length){b("#btnAgree2").attr("checked",true);b("#btnAgree2").click(function(){if(b(this).attr("checked")){b("#subPay2").removeClass("disabled");b("#subPay2").attr("disabled",false)}else{b("#subPay2").addClass("disabled");b("#subPay2").attr("disabled",true)}})}if(b("#btnAgree3").length){b("#btnAgree3").attr("checked",true);b("#btnAgree3").click(function(){if(b(this).attr("checked")){b("#exchangePay").removeClass("disabled");b("#exchangePay").attr("disabled",false)}else{b("#exchangePay").addClass("disabled");b("#exchangePay").attr("disabled",true)}})}b("#subPay1").bind("click",d.subPayBtn);b("#subPay2").bind("click",d.subPayBtn);b("#exchangePay").bind("click",d.subPayBtn)},subPayBtn:function(){var e=c;if(e.isUsingRC!=1){var d=b("#userFavText");if(b("input:radio[name='use_radio'][checked]").val()==0){if(b("#userFavSel").val().trim()=="0000000000"){var g=""}else{var g=b("#userFavSel").val().trim().replace(/[^a-zA-z0-9]/g,"")}}else{if(b("input:radio[name='use_radio'][checked]").val()==1){if(b("#userFavText").val().trim()=="输入十位优惠码"){var g=""}else{var g=b("#userFavText").val().trim().replace(/[^a-zA-z0-9]/g,"")}}else{var g=""}}if(!b("#coupon_num").is(":hidden")&&g&&(!/^[a-zA-z\d]{10}$/g.test(g)||b("#code").data("flag")!=1)&&g!="0000000000"){e.showFavTextErr(2);b.dialog({title:"网易电影",width:496,button:["*确定"],content:'<div class="mDialog selDialog"><h2><b></b>优惠码错误，请重新输入十位优惠码！</h2></div>'},function(){b("#onShowTR").closest("table")[0].scrollIntoView();return false});return false}b("#code").val(g);if(b("#coupon_num").is(":hidden")&&b("#code")[0]){b("#code").val("")}}if(b(".timer")[0]&&b(".timer").data("timer_flag")==1){e.showDialogCom(0,'<div class="mDialog selDialog"><h2><b></b>抱歉哈，订单超时关闭了，需要重新选座哦！</h2><br /><a href="'+c.mailApp+"/order/seat.html?ticket_id="+c.productId+'&seatArea=1" class="btn_orange">重新选座</a></div>');b(".iDialogClose").remove();return false}if(!e.easyNav.isLogin()){e.login();return false}b("#payForm").submit();b(".timer").data("pay_flag",1);if(e.noPay){b.dialog({title:"",width:500,button:[],css:"payDialog",content:'<div class="payMeg"><h2>兑票</h2><div class="main"><strong>您可以根据您的兑票情况，选择相应操作：</strong></div><div class="btn"><input type="button" value="已成功兑票" id="nopay_btn_01"/><input type="button" value="兑票遇到问题" class="ml10" id="pay_btn_02"/></div></div>',beforeClose:function(){var h=b("#displayGorderId").val().trim();a.location.href="http://order.mall.163.com"+c.mailAppOrder+"/movie/list.html?gorderId="+h}})}else{b.dialog({title:"",width:500,button:[],css:"payDialog",content:'<div class="payMeg"><h2>付款</h2><div class="main"><strong>您可以根据您的付款情况，选择相应操作：</strong></div><div class="btn"><input type="button" value="已完成付款" id="pay_btn_01"/><input type="button" value="付款遇到问题" class="ml10" id="pay_btn_02"/></div></div>',beforeClose:function(){c.payCloseHref()}})}},payCloseHref:function(){var d=b("#displayGorderId").val().trim();c.post("/order/check_pay_result.html",{order_id:d},function(h,g){if(!h&&g){var e=c;g=e.parseJSON(g);switch(+g.retcode){case 200:if(g.isPayed){a.location.href="http://order.mall.163.com"+c.mailAppOrder+"/movie/list.html?gorderId="+d}else{a.location.reload()}break;default:a.location.reload()}}})},timerOverPost:function(){var d=b("#displayGorderId").val().trim();c.post("/order/check_pay_result.html",{order_id:d},function(h,g){if(!h&&g){var e=c;g=e.parseJSON(g);switch(+g.retcode){case 200:if(g.isPayed){return}else{b("#last").hide();b("#invalid").show()}break;default:b("#last").hide();b("#invalid").show()}}})},timerStar:function(m){var l=14000/15;var e=m*l;var g=new Date();var d={};var h=b("#min"),i=b("#sec");var j=0;var k=a.setInterval(function(){var o=new Date();var r=o-g;var p=e-r;var n=parseInt(p/60/l);var q=parseInt((p/l)%60);if(n!=d.m){d.m=n;h.html(d.m<10?("0"+d.m):d.m)}if(q!=d.s){d.s=q;i.html(d.s<10?("0"+d.s):d.s)}if(n==0&&q==0){clearInterval(k);j=1;if(b(".timer").data("pay_flag")&&b(".timer").data("pay_flag")==1){c.timerOverPost()}else{b("#last").hide();b("#invalid").show();c.showDialogCom(0,'<div class="mDialog selDialog"><h2><b></b>抱歉哈，订单超时关闭了，需要重新选座哦！</h2><br /><a href="'+c.mailApp+"/order/seat.html?ticket_id="+c.productId+'&seatArea=1" class="btn_orange">重新选座</a></div>');b(".iDialogClose").remove()}}b(".timer").data("timer_flag",j)},100)},showDialog:function(e){var d={title:"",width:496,button:["*原价支付","换新号码"],content:'<div class="mDialog selDialog"><h2><b></b>'+e+"</h2></div>",check:c.diaClose};return b.dialog(d)},diaClose:function(d){if(d==0){a.location.href=c.mailApp+"/order/seat.html?ticket_id="+b("#productId").val()+"&order_id="+b("#order_id").val()+"&seatArea=1"}},showDialogCom:function(d,e){if(d==0){b.dialog({title:"",width:500,button:[],css:"codeDialog",content:e,beforeClose:function(){c.hideSelect()}})}else{if(d==1){b.dialog({title:"",width:500,button:["*确定"],css:"codeDialog",content:e,beforeClose:function(){c.hideSelect()}})}else{if(d==2){b.dialog({title:"",width:500,button:[],css:"codeDialog",content:e,animate:0,beforeClose:function(){c.hideSelect()}})}}}},hideSelect:function(){if(b.isIE6&&b("#userFavSel")[0]){var d=b("#userFavSel");d.css("visibility","visible")}}})})(window,jQuery,Core);