;M.add("www-movie",function(e){var t,a=e.mt.util,n=a.Cookie,o=e.mt.www;e.namespace("mt.www.Movie"),e.mt.www.Movie={initMovieDesc:function(a,n,i){function s(e){var t,a=l.one(".J-evaluate-suffix"),n=l.one(".J-star-container");switch(e=parseInt(e,10)){case 1:case 2:t="超烂啊";break;case 3:case 4:t="比较差";break;case 5:case 6:t="一般般";break;case 7:case 8:t="比较好";break;case 9:t="棒极了";break;case 10:t="完美";break;default:t="超烂啊"}n.one(".J-star-content").setStyle("width",10*e+"%"),a.setHTML(e+"分，"+t),a.addClass("operation__suffix--evaluate")}function c(){t?t.open():t=o.Dialog.login({origin:"movie-rate",loginRef:n})}function r(t){var a={method:"POST",data:t};e.io(g,a)}var l=e.one(".J-movie-container"),d=e.one("#J-short-movie-desc"),m=e.one("#J-long-movie-desc"),g="/movie/wishandscore/"+i;l.delegate("click",function(){m&&m.show(),d&&d.hide()},"#J-unfold-movie-desc"),l.delegate("click",function(){m&&m.hide(),d&&d.show()},"#J-fold-movie-desc"),l.delegate("click",function(){var e,t,n=this.next(".J-star-container"),o=this.ancestor(".operation").one(".J-evaluate");a?(this.replaceClass("star-circle--grey","star-circle"),n.show(),e=l.delegate("mousemove",function(e){var a=this.getX(),n=e.pageX;this.setStyle("cursor","pointer"),t=Math.min(parseInt(Math.round(n-a)/11,10)+1,10),s(t),o.replaceClass("star-circle","star-circle--grey")},".J-star-container"),l.delegate("click",function(){n.hide(),e.detach(),r({score:t,wish:1}),l.one(".J-evaluate").setAttribute("data-score",t),o.replaceClass("star-circle--grey","star-circle")},".J-star-container")):c()},".J-evaluate")},initToggleSwitcher:function(t,a){var n=this,o=e.one(".J-switcher"),i=e.one(".J-cinema-info"),s=e.one(".J-comment-wrapper");o.delegate("click",function(){o.all(".J-tab").removeClass("current"),this.addClass("current"),"cinema"===this.getData("name")?(i.show(),s.hide()):(i.hide(),s.show(),s.one(".J-loader")&&n.getHotComments(t,a))},".J-tab")},initShareComment:function(t,a){var n,o=e.one(".J-comment-list"),i=e.one("#share-comment-dialog-markup").getHTML(),s=0;o&&o.delegate("click",function(){var o,c,r="#"+t+"#"+this.ancestor(".comment").getData("comment")+"（来自猫眼影评）@猫眼电影",l=this.ancestor(".comment").getData("commentid"),d=e.one("#share-comment-dialog"+(s-1)),m="share-comment-dialog"+s;c=encodeURIComponent("http://www.maoyan.com/s/comment/"+l),r=encodeURIComponent(r),o=e.Lang.sub(i,{comment:r,movieId:a,url:c}),d&&d.ancestor("#mt-simpledialog-container").remove(),n=new e.mt.widget.SimpleDialog({id:m,node:this,width:120,content:o}),e.one("#"+m).addClass("share-comment-dialog"),n.open(),s++},".J-share")},getHotComments:function(t,n){var o,i,s,c,r=this,l="/movie/hotcomments/"+t,d=e.one(".J-comment-wrapper");e.io(l,{method:"GET",on:{success:function(l,m){var g=a.getEvalRes(m);if(1===g.status){var h,u=g.data.commentList,v=g.data.total;v>0?(s='<a class="link" href="/dianying/yingping/{movieid}" gaevent="dianying/'+t+'/CommentAllTop">查看全部{total}条<i class="F-glob F-glob-caret-right-small"></i></a>',c='<a class="link" href="/dianying/yingping/{movieid}" gaevent="dianying/'+t+'/CommentAllBottom">查看全部{total}条<i class="F-glob F-glob-caret-right-small"></i></a>'):(s='<span class="no-link">查看全部{total}条</span>',c='<span class="no-link">查看全部{total}条</span>'),o='<div class="comment-list-header cf"><span class="title">《{movieName}》的热门影评</span>'+s+"</div>",i='<div class="comment-list-footer cf">'+c+"</div>",h=e.Lang.sub(o,{movieName:n,total:v,movieid:t})+u+e.Lang.sub(i,{total:v,movieid:t}),d.setHTML(h),d&&r.initShareComment(n,t)}}}})},deleteOrder:function(t){(t=e.one(t))&&e.use("www-order",function(e){var a=e.mt.www.Order;t.delegate("click",function(e){e.preventDefault(),a.cancel(this,function(e){e.ancestor("table").all("tr").size()<3?window.location.reload():e.ancestor("tr").remove()})},".order-cancel")})},sendMsg:function(t){function n(){s&&s.isInProgress()||(s=e.io(r,{method:"POST",on:{success:function(e,t){a.getEvalRes(t).status?o():i()},failure:function(){t.addClass(l)}}}))}function o(){var e,a=60;t.setHTML("重新获取("+a+")").addClass(l),e=window.setInterval(function(){a-=1,a?t.setHTML("重新获取("+a+")"):(window.clearInterval(e),t.setHTML("重新获取").removeClass(l))},1e3)}function i(){var e=t.ancestor();e.removeChild(t),e.appendChild('<span style="color:#D00;">发送验证码失败。请稍后重试。</span>')}var s=null,c=0,r="",l="btn-disabled";(t=e.one(t))&&(c=a.data(t,"orderid"),r="/movie/sendmsg/"+c,t.on("click",function(e){e.preventDefault(),n()}))},asyncLoadSideMovie:function(t,a,n,o){var i,s,c,r,l=e.mt.www.Deal.AsyncLoader,d=e.one(".J-side-movie-wrapper"),m=M.window;i="/movie/movielist/"+t+"/"+(a||10)+"/"+n,o&&(i+="/"+o),s={action:i,async:null,method:"get",wrapper:d,callback:function(e){""!==e.data&&(d.setHTML(e.data),c.detach(),r.detach())}},l.winHeight=e.DOM.winHeight(),c=m.resize(function(){l.winHeight=e.DOM.winHeight(),l.asyncLoadWithCheck(s)},12),r=m.scroll(function(){l.asyncLoadWithCheck(s)},12),l.asyncLoadWithCheck(s)},initMaoyanQrCode:function(t,a){var o,i=e.one(t),s={vAlign:"top",vTopOffset:200,hAlign:"right",vBottomOffset:140,bottomEdge:".site-info-w",hideWhenTooNarrow:!0};e.mix(a,s),i&&!n.get("maoyan-qrcode")&&("undefined"==typeof a.topEdge&&(a.topEdge=e.one(".movie-tab").getY()+100),e.use("uix-sticky",function(e){o=new e.mt.uix.Sticky(i,a),i.delegate("click",function(e){e.halt();var t=n.getExpiresDate(1,0,0);i.remove(!0),o.destroy(),n.set("maoyan-qrcode","1",t,"/","."+M.DOMAIN_HOST)},".close")}))}}},"1.0.0",{requires:["www-base","mt-base","www-dialog","www-deal","w-simpledialog"]});
