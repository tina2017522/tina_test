;M.add("cinema-list",function(e){var t,a,i,n,o=e.io,s=e.UA.ie,c=e.mt.util,r=e.mt.www;e.mt.ComponentHub.attach("cinema-list",function(l){function m(){var t,a=e.all(".promotion-active");if(0!==a.size()){t=!!a.item(0).one(".trigger__head"),e.all(".promotion-active").each(function(e){e.delegate("hover",function(){var e,a,i=this.ancestor(".J-promotion-active"),n=i.one(".J-content"),o=!0;if(this.ancestor("#cinema-action-dialog")){var s=this.ancestor(".J-cinema-seats-table"),c=i.getY()+i.get("offsetHeight")+150,r=s.getY()+s.get("offsetHeight");s.setStyle("position","relative"),c>r&&(o=!1)}o&&(t?(a=i.one(".J-trigger"),e="trigger--hover"):(a=i,e="promotion-active--hover"),a.addClass(e),i.addClass("promotion-active--current"),n.setStyle("width",a.get("region").width-2+"px"),n.show())},".J-trigger")});var i=t?".J-cinema-item":".J-cinema-seats-table";e.all(i).each(function(e){e.delegate("mouseleave",function(){var e,a,i=this.one(".J-content");t?(a=this.one(".J-trigger"),e="trigger--hover"):(a=this,e="promotion-active--hover"),this.removeClass("promotion-active--current"),a.removeClass(e),i.hide()},".J-promotion-active")})}}function d(e){a?a.open():a=r.Dialog.login({origin:"cinema-list",loginRef:e}),a.setCookie(e)}var g=this,h=l.component.params;h&&h.movieId&&(function(){function a(t,a){if(a.target.ancestor(".cinema-item").one("..J-cinema-seats"))return void t.set("content",n.ancestor(".cinema-item").one(".J-cinema-seats").getHTML());var i,n=a.target,s=e.JSON.parse(n.getData("params")),r=s.date,l=s.geo,d=s.movieId,g=s.cinemaId,h=s.pid,u="/movie/showlist/"+d+"/"+h+"/"+g+"/"+r+"/"+l;o(u,{method:"GET",on:{success:function(e,a){var o=c.getEvalRes(a);1===o.status&&(i=o.data,n.ancestor(".cinema-item").append(i),t.set("content",n.ancestor(".cinema-item").one(".J-cinema-seats").getHTML()),m())}}})}function r(e){var o,s,r,m,d=this.ancestor(".J-cinema-item"),g=!1,h=!1;d&&(m=c.decodeAttr(d,"params"),l(),m.id!==i&&(g=!0,i=m.id),this.hasClass("J-deal-dialog")?(o="deal",r=".J-cinema-deals"):this.hasClass("J-select-dialog")&&(o="seat",r=".J-cinema-seats"),n!==o&&(h=!0,n=o),g||h?(s=d.one(r),this.hasClass("J-select-dialog")?(t.set("content",'<div class="loading-mask"></div>'),t.set("title",m.nm),t.open(),a(t,e)):(t.set("content",s.getHTML()),t.set("title",m.nm),t.open())):t.open())}function l(){var e,a=s&&s<8;t||(t=new h({id:"cinema-action-dialog",width:"750"}),t.after("close",function(){e=t.one("table"),a&&e&&e.hide()}),t.on("open",function(){a&&e&&e.show()}))}var d=g.one("#J-cinema-info-list"),h=e.mt.Dialog;d&&d.delegate("click",r,".J-deal-dialog, .J-select-dialog")}(),function(a){function i(a){if(!i||!i.isInProgress())var i=e.io(a,{method:"GET",on:{success:function(a,i){var n,o,s=c.getEvalRes(i);1===s.status&&(n=e.Node.create(s.data),o=n.getHTML(),t.set("content",o),m())}}})}a&&e.one(document).delegate("click",function(){if(!this.hasClass("current")){var e=this.ancestor(".cinema-item__seats"),t=e&&e.next(".paginator"),n=c.data(this,"date"),o=c.data(this,"geo"),s=c.data(this,"cinema"),r=c.data(this,"pid"),l="/movie/showlist/"+a+"/"+r+"/"+s+"/"+n+"/"+o;this.ancestor("ul").all(".item").removeClass("current"),this.addClass("current"),e.one(".J-cinema-seats-table").setHTML('<p class="empty">排片信息加载中……</p>'),t&&t.remove(!0),i(l)}},".cinema-seats-filter .item")}(h.movieId),function(){function a(e,t){window.location.href="http://maoyan.meituan.com/xuanzuo/shop/"+e+"/show/"+t+"/seats"}var i=e.one(document),n=null;i.delegate("click",function(e){e.preventDefault(),n&&n.isInProgress()&&n.abort();var i=c.data(this,"pid"),s=c.data(this,"seq");n=o("/movie/xuanzuo/"+s+"/"+i,{method:"GET",on:{success:function(e,n){var o=c.getEvalRes(n);switch(t&&"open"===t._status&&t.close(),o.status){case 1:r.Dialog.alert("已停止售票");break;case 2:r.Dialog.alert("全部座位已售完");break;case 3:d(o.refer);break;case 4:r.Dialog.Mobile.bind(o.content,o.needSmsUp);break;default:a(i,s)}}}})},".J-select-seat")}()),function(){m()}()})},"1.0.0",{requires:["www-base","www-dialog"]});
;M.add("downtip",function(n){n.mt.www.DownTip={handle:function(){var t=n.one(".tip-contain");n.one(".close-it").on("click",function(){t.hasClass("tip-contain")&&t.removeClass("tip-contain").addClass("closetip")})}},n.mt.ComponentHub.attach("downtip",function(){n.mt.www.DownTip.handle()})},"1.0.0",{requires:["www-base"]});
